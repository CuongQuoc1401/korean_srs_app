{% extends "learning/base.html" %}

{% block content %}
    <h2>üìù √în T·∫≠p T·ª´ V·ª±ng</h2>

    {% if word %}
        <p>C√≤n l·∫°i: <strong>{{ remaining_count|add:1 }}</strong> t·ª´ c·∫ßn √¥n t·∫≠p h√¥m nay.</p>
        
        <div id="word-card">
            <h3>{{ word.korean_word }}</h3>
            
            <button onclick="showAnswer()">Xem Nghƒ©a</button>
            
            <div id="answer-details" style="display:none; border: 1px solid #ccc; padding: 15px; margin-top: 10px;">
                <p><strong>Nghƒ©a:</strong> {{ word.vietnamese_meaning }}</p>
                <p><strong>H√°n t·ª±:</strong> {{ word.hanja|default:"Kh√¥ng c√≥" }}</p>
                <p><strong>V√≠ d·ª•:</strong> {{ word.example_sentence|default:"Kh√¥ng c√≥" }}</p>
                <p><strong>Ghi ch√∫:</strong> {{ word.notes|default:"Kh√¥ng c√≥" }}</p>
                <p><strong>C·∫•p ƒë·ªô hi·ªán t·∫°i:</strong> C·∫•p {{ word.level }}</p>

                <hr>

                <h4>B·∫°n tr·∫£ l·ªùi:</h4>
                <button onclick="recordAnswer('{{ word.id }}', 'correct')" style="background-color: green; color: white; padding: 10px;">‚úÖ ƒê√∫ng</button>
                <button onclick="recordAnswer('{{ word.id }}', 'wrong')" style="background-color: red; color: white; padding: 10px;">‚ùå Sai</button>
            </div>
        </div>
        <div id="message-area" style="margin-top: 15px; font-weight: bold;"></div>

    {% else %}
        {% include "learning/review_done.html" %}
    {% endif %}

    <script>
        function showAnswer() {
            document.getElementById('answer-details').style.display = 'block';
            document.querySelector('button[onclick="showAnswer()"]').style.display = 'none';
        }

        function recordAnswer(wordId, result) {
            // Ch·∫∑n ng∆∞·ªùi d√πng nh·∫•n nhi·ªÅu l·∫ßn
            document.getElementById('answer-details').style.pointerEvents = 'none';

            fetch(`{% url 'check_word' word_id='REPLACE_ID' result='REPLACE_RESULT' %}`.replace('REPLACE_ID', wordId).replace('REPLACE_RESULT', result))
                .then(response => response.json())
                .then(data => {
                    const messageArea = document.getElementById('message-area');
                    if (data.success) {
                        messageArea.style.color = 'blue';
                        messageArea.innerHTML = data.message + ' T·∫£i t·ª´ ti·∫øp theo...';
                        
                        // T·∫£i l·∫°i trang sau 2 gi√¢y ƒë·ªÉ l·∫•y t·ª´ ti·∫øp theo
                        setTimeout(() => {
                            window.location.reload(); 
                        }, 2000);
                        
                    } else {
                        messageArea.style.color = 'red';
                        messageArea.innerHTML = 'L·ªói: ' + data.error;
                        document.getElementById('answer-details').style.pointerEvents = 'auto'; // Cho ph√©p nh·∫•n l·∫°i n·∫øu l·ªói
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('message-area').innerHTML = 'C√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi.';
                    document.getElementById('answer-details').style.pointerEvents = 'auto';
                });
        }
    </script>
{% endblock content %}